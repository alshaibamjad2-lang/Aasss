<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… â€” Supabase</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Cairo:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Ø£Ø³Ù„ÙˆØ¨ Ø¨Ø³ÙŠØ· ÙÙ‚Ø· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø£Ù‚Ù„ Ù…Ù† ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙ‚Ø· Ù„ØªØ®ØªØ¨Ø± supabase) -->
<style>
body {
  background: #000;
  color: #fff;
  font-family: "Cairo", sans-serif;
  margin: 0;
  padding: 20px;
}
.section-btn {
  padding: 10px;
  margin: 5px;
  background: #333;
  color: gold;
  border-radius: 8px;
  border: 1px solid gold;
  cursor: pointer;
}
.section-btn.active { background: gold; color: #000; }
.meal {
  background: #111;
  padding: 10px;
  border-radius: 10px;
  border:1px solid #333;
  margin-bottom: 15px;
}
.meal img {
  width: 100%;
  border-radius: 8px;
  height: 180px;
  object-fit: cover;
}
.price { color: gold; font-size: 18px; margin-top: 8px; }
</style>
</head>
<body>

<h2 style="color:gold; text-align:center;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… â€” Supabase</h2>

<!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
<div id="sections"></div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div id="meals"></div>

<!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// --------------------------------
// Ø¥Ø¹Ø¯Ø§Ø¯ Supabase â€” Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹
// --------------------------------
const SUPABASE_URL = "https://ztwbgqkxmdhpzqhnefty.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0d2JncWt4bWRocHpxaG5lZnR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMTQwMDEsImV4cCI6MjA3OTU5MDAwMX0.6W_V9v5VxQpPfv65Ygc51-m7G1Z8sl8fx1B8bWyA6Xg";

const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let allCategories = [];
let allProducts  = [];

// --------------------------------
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… + Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
// --------------------------------
async function loadMenu() {
  console.log("ğŸ“¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase...");

  // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  const { data: categories, error: cErr } = await db
    .from("categories")
    .select("*")
    .order("id", { ascending: true });

  if (cErr) return console.error("âŒ Ø®Ø·Ø£ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:", cErr);

  allCategories = categories;

  // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const { data: products, error: pErr } = await db
    .from("products")
    .select("*")
    .order("id", { ascending: true });

  if (pErr) return console.error("âŒ Ø®Ø·Ø£ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", pErr);

  allProducts = products;

  renderCategories();
  renderMeals("all");
}

// --------------------------------
// Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
// --------------------------------
function renderCategories() {
  const box = document.getElementById("sections");
  box.innerHTML = "";

  box.innerHTML += `<button class="section-btn active" data-id="all">Ø§Ù„ÙƒÙ„</button>`;

  allCategories.forEach(cat => {
    box.innerHTML += `
      <button class="section-btn" data-id="${cat.id}">${cat.name}</button>
    `;
  });

  document.querySelectorAll(".section-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelector(".section-btn.active")?.classList.remove("active");
      btn.classList.add("active");
      renderMeals(btn.dataset.id);
    });
  });
}

// --------------------------------
// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
// --------------------------------
function renderMeals(sectionId) {
  const box = document.getElementById("meals");
  box.innerHTML = "";

  const list =
    sectionId === "all"
      ? allProducts
      : allProducts.filter(p => p.category_id == sectionId);

  list.forEach(p => {
    box.innerHTML += `
      <div class="meal">
        <img src="${p.image_url || ""}">
        <h3>${p.name}</h3>
        <div class="price">${p.price} Ø±.Ø³</div>
        <p>${p.description || ""}</p>
      </div>
    `;
  });
}

// ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
loadMenu();
</script>

</body>
</html>